# 📊 Googleフォーム - スプレッドシート連携とメール通知設定

entry IDの設定が完了したら、次はスプレッドシートとの連携とメール通知を設定します。

---

## ステップ1: スプレッドシートとの連携

### 1-1. Googleフォームの「回答」タブを開く

1. Googleフォームの編集画面を開く
   ```
   https://docs.google.com/forms/d/1cAvRmsZqw0zffZZOAe7OU1-STeaaDTqiwDjE0WYq9R4/edit
   ```

2. 上部の **「回答」** タブをクリック

### 1-2. スプレッドシートを作成

1. 右上の **緑色のスプレッドシートアイコン** をクリック
   ```
   ┌─────────────────────────────┐
   │  回答                  📊  │  ← このアイコン
   └─────────────────────────────┘
   ```

2. ポップアップが表示されたら、以下を選択：
   - ○ **新しいスプレッドシートを作成**
   - スプレッドシート名: `レストラン予約管理` （または任意の名前）

3. **「作成」** ボタンをクリック

4. 新しいタブでGoogleスプレッドシートが開きます

### 1-3. スプレッドシートの確認

スプレッドシートには以下の列が自動で作成されます：

| タイムスタンプ | 予約日時 | 予約時間 | 人数 | コース | お名前 | フリガナ | メールアドレス | 電話番号 | ご要望・アレルギー |
|--------------|---------|---------|-----|--------|--------|---------|--------------|---------|------------------|
|              |         |         |     |        |        |         |              |         |                  |

✅ これで、予約が入るとこのスプレッドシートに自動で記録されるようになりました！

---

## ステップ2: メール通知の設定

予約が入ったときに、自動でメール通知を受け取る設定をします。

### 2-1. 通知ルールを開く

1. **先ほど作成したスプレッドシート** を開いた状態で
2. メニューバーの **「ツール」** → **「通知ルール」** をクリック

### 2-2. 通知ルールを作成

通知ルールの設定画面で、以下を設定：

```
┌─────────────────────────────────────────┐
│ 通知ルール                               │
├─────────────────────────────────────────┤
│                                         │
│ 次の場合に通知する:                      │
│   ○ ユーザーがフォームを送信したとき     │  ← これを選択
│   ○ ユーザーがこのスプレッドシートを     │
│      編集したとき                        │
│   ○ 変更があったとき                     │
│                                         │
│ 通知方法:                                │
│   ○ メール - 毎日のダイジェスト          │
│   ● メール - すぐに                      │  ← これを選択
│                                         │
│          [保存]  [キャンセル]           │
└─────────────────────────────────────────┘
```

3. **「保存」** ボタンをクリック

### 2-3. 確認

設定完了後、以下のメッセージが表示されます：

```
✓ 通知ルールが保存されました
```

これで、予約が入るたびに、Googleアカウントに登録されているメールアドレスに通知が届くようになりました！

---

## ステップ3: フォームが回答を受け付けているか確認

### 3-1. 回答受付状態を確認

1. Googleフォームの編集画面で **「回答」** タブをクリック

2. 右上のスイッチが **「回答を受付中」** になっているか確認
   ```
   ┌────────────────────────────┐
   │ 回答を受付中  ●━━━━○      │  ← ONになっていればOK
   └────────────────────────────┘
   ```

3. もしOFFになっていたら、スイッチをクリックしてONにする

---

## ステップ4: テスト送信

すべての設定が完了したので、実際にテストしてみましょう！

### 4-1. 予約システムでテスト予約

1. ブラウザで **reservation.html** を開く
   ```
   simple-restaurant/reservation.html
   ```

2. 適当なテストデータを入力して予約を送信
   - 日付: 今日以降の日付を選択
   - 時間: ランチまたはディナー
   - 人数: 2名
   - コース: 任意
   - お名前: テスト 太郎
   - フリガナ: テスト タロウ
   - メールアドレス: あなたのメールアドレス
   - 電話番号: 090-1234-5678
   - ご要望: テスト送信

3. **「予約を確定する」** ボタンをクリック

### 4-2. スプレッドシートで確認

1. Googleスプレッドシートを開く（自動で更新されます）

2. **新しい行にテストデータが追加されている** ことを確認
   ```
   | 2025/11/15 14:30:00 | 2025年11月20日(水) | 12:00 | 2名 | ランチコース | テスト 太郎 | ... |
   ```

### 4-3. メール通知を確認

1. メールボックスを開く

2. 件名: **「新しいフォーム送信: レストラン予約フォーム」** のようなメールが届いているか確認

3. メール本文に予約内容が記載されています

---

## ✅ 完了チェックリスト

すべて完了したか確認してください：

- [ ] スプレッドシートが作成された
- [ ] スプレッドシートに列見出しが表示されている
- [ ] メール通知ルールが設定された（「ユーザーがフォームを送信したとき」「すぐに」）
- [ ] フォームが「回答を受付中」になっている
- [ ] テスト送信が成功した
- [ ] スプレッドシートにテストデータが表示された
- [ ] メール通知が届いた

---

## 🎉 セットアップ完了！

これで、予約システムが完全に動作するようになりました！

お客様が予約を送信すると：
1. ✅ スプレッドシートに自動で記録される
2. ✅ あなたのメールアドレスに通知が届く
3. ✅ お客様には予約番号が表示される

---

## 📝 よくある質問

### Q1: メールが届かない場合

**確認事項:**
1. 通知ルールが正しく設定されているか
2. Googleアカウントのメールアドレスが正しいか
3. 迷惑メールフォルダに入っていないか
4. Googleからの通知が許可されているか（Googleアカウント設定）

### Q2: スプレッドシートにデータが表示されない場合

**確認事項:**
1. [reservation.js:11](simple-restaurant/js/reservation.js#L11) のピリオドが削除されているか
2. entry IDが正しく設定されているか
3. フォームが「回答を受付中」になっているか
4. ブラウザのコンソール（F12 → Console）にエラーが出ていないか

### Q3: 複数のメールアドレスに通知を送りたい

**方法:**

スプレッドシートで:
1. **「ツール」** → **「Apps Script」** を開く
2. 以下のコードを貼り付け:

```javascript
function sendEmailNotification(e) {
  const emails = [
    'email1@example.com',
    'email2@example.com',
    'email3@example.com'
  ];

  const subject = '新しい予約が入りました';
  const body = '予約内容:\n' + JSON.stringify(e.namedValues, null, 2);

  emails.forEach(email => {
    MailApp.sendEmail(email, subject, body);
  });
}
```

3. **「保存」** をクリック
4. **「トリガー」** → **「トリガーを追加」**
5. イベントのソース: **「フォームから」**、イベントの種類: **「フォーム送信時」**
6. **「保存」**

これで、複数のメールアドレスに通知が送られます。

---

## 🔧 トラブルシューティング

### エラー: "CORS policy" が表示される

これは正常です。`no-cors` モードで送信しているため、ブラウザのコンソールにこのエラーが表示されることがありますが、**実際には送信は成功しています**。

スプレッドシートを確認して、データが記録されていれば問題ありません。

### データがおかしい / 文字化けする

entry IDの設定が間違っている可能性があります。GET_ENTRY_IDS.mdを参照して、再度entry IDを確認してください。

---

**これで予約システムのセットアップは完全に完了です！**
